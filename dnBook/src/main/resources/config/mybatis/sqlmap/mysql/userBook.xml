<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.dnBook.mapper.UserBookMapper">
    <resultMap type="book" id="bookMap">
    	<result column="book_code" property="bookCode"/>
    	<result column="board_no" property="boardNo"/>
    	<result column="cover_img" property="coverImg"/>
    	<result column="title" property="title"/>
    	<result column="publisher" property="publisher"/>
    	<result column="author" property="author"/>
    	<result column="translator" property="translator"/>
    	<result column="description" property="description"/>
    	<result column="price" property="price"/>
    	<result column="rent_price" property="rentPrice"/>
    	<result column="rental_dir_path" property="rentalDirPath"/>
    	<result column="pdf_path" property="pdfPath"/>
    	<result column="pub_date" property="pubDate"/>
    	<result column="category_code" property="categoryCode"/>
    </resultMap>
    
    <select id="selectBook" resultMap="bookMap">
    	select *
    	  from t_book
    </select>

    <!-- 게시물 상세 -->
    <select id="selectOneBoook" parameterType="int" resultMap="bookMap">
		select *
		  from t_book 
		 where book_code = #{bookCode}    
    </select>
    
    <!-- 게시물 추천수 -->		<!-- 추천하기 바꿔야함 ★ -->
    <resultMap type="bookRecom" id="bookRecomMap">
    	<result column="recom_no" property="recomNo"/>
    	<result column="id" property="id"/>
    </resultMap>
    <select id="selectRecomCount" resultType="int" parameterType="bookRecomMap">
		select count(*)
		  from t_book_recom
		 WHERE id = #{id}
		   AND recomNo = #{recomNo}      
    </select>

    <!-- 장바구니 -->
    <resultMap type="Wish" id="WishMap">
    	<result column="book_code" property="bookCode"/>
    	<result column="id" property="id"/>
    </resultMap>
    <insert id="insertWish" parameterType="WishMap">
	    insert into t_Wish (       
		    bookCode, id
		) values (
		    #{bookCode}, #{id}
		)
    </insert>    
    <!-- 추천 삭제 -->
    <insert id="deleteWish" parameterType="WishMap">
	    delete 
	      from t_Wish 			
	     where bookCode = #{bookCode}
	       and id = #{id}
    </insert> 
    
    
    
     <!-- 게시물 댓글 조회 -->
    <select id="selectReview" parameterType="int" resultType="review">
		select comment_no as commentNo, bookCode, id, content, reg_date as regDate
		  from t_comment				
		 where no = #{no}      
    </select>

    <!-- 댓글 조회 -->
    <select id="selectReviewByPk" parameterType="int" resultType="review">
		select review_no as reviewNo, bookCode, id, content, reg_date as regDate
		  from t_comment			
		 where review_no = #{reviewNo}      
    </select>
    
    <!-- 댓글 입력 -->
    <insert id="insertReview" parameterType="review">
	    <selectKey keyProperty="reviewNo" resultType="int" order="BEFORE">
			select s_comment_no.nextVal from dual			
		</selectKey>
	    insert into t_comment (    				
		    review_no, bookCode, id, content   
		) values (
		    #{reviewNo}, #{bookCode}, #{id}, #{content}
		)
    </insert>

    <!-- 댓글 수정 -->
    <update id="updateReview" parameterType="review">
        update t_comment  				
		   set content = #{content}
		 where review_no = #{reviewNo}        
    </update>
    
    <!-- 댓글 삭제 -->
    <delete id="deleteReview" parameterType="int">
        delete t_comment			
		 where review_no = #{reviewNo}
    </delete>
</mapper>


























